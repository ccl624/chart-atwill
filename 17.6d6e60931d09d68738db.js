(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{Tmxe:function(t,e,n){"use strict";n.r(e);var i=n("CcnG"),r=function(){function t(t){this.http=t}return t.prototype.getShelfData=function(){return this.http.get("assets/json/bookshelf.json")},t}(),o=function(){function t(t){this.bookshelfDemoService=t,this.shelfData=[]}return t.prototype.ngOnInit=function(){var t=this;this.bookshelfDemoService.getShelfData().subscribe(function(e){t.shelfData=e})},t}(),a=function(){return function(){}}(),s=n("pMnS"),h=n("VphZ"),l=function(){function t(){this.shelfData=[],this.width=0,this.height=0,this.U=5}return Object.defineProperty(t.prototype,"data",{get:function(){return this.shelfData},set:function(t){this.shelfData=t,this.shelfData&&this.shelfData.length>0&&this.initBookShelf()},enumerable:!0,configurable:!0}),t.prototype.ngOnInit=function(){},t.prototype.initBookShelf=function(){var t=this,e=h.y(this.bookshelf.nativeElement);this.width=Number.parseFloat(e.style("width")),this.height=Number.parseFloat(e.style("height")),this.svg=e.append("svg").attr("class","shelf-svg").attr("viewBox","0 0 "+this.width+" "+this.height).attr("preserveAspectRatio","xMinYMin meet").attr("width","100%").attr("height","100%"),this.shelfNodes=this.svg.selectAll(".shelf-item-g").data(this.shelfData.map(function(e,n){return e.height=120*t.U,e.width=60*t.U,e.tx=(e.width+1)*n,e.ty=t.height-e.height,e.shelfLevels.reduce(function(n,i,r){return i.width=e.width,i.height=15*t.U,i.ty=n-i.height,i.tx=0,i.source={isFree:!1,tx:i.tx,ty:i.ty},i.color=h.x[r],i.ty},e.height),e})).enter().append("g").attr("class","shelf-item-g").attr("transform",function(t,e){return"translate("+t.tx+","+t.ty+")"}),this.shelfNodes.append("rect").attr("class","shelf-item-rect").attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("fill","#ffffff").attr("stroke","orange").attr("stroke-width",0);var n=this;this.shelfNodes.each(function(t,e){n.updateShelfLevel(t.shelfLevels,this,!1)}),this.forbidArea=this.addNoteArea({fillColor:"red",note:"\u533a\u57df\u5df2\u6ee1",fontSize:36}),this.originArea=this.addNoteArea({fillColor:"green",note:"\u8d77\u59cb\u4f4d\u7f6e",fontSize:18})},t.prototype.addNoteArea=function(t){var e=this.svg.append("g").attr("class","note-area-g").style("display","none");return e.append("rect").attr("class","note-area-rect").attr("fill",t.fillColor).attr("stroke",t.fillColor).attr("fill-opacity",.3).attr("stroke-width",1).attr("stroke-dasharray","5,5"),e.append("text").attr("class","note-area-text").text(t.note).attr("fill","#ffffff").attr("opacity",.8).style("font-size",t.fontSize).style("font-weight","600").attr("dominant-baseline","middle").attr("text-anchor","middle"),e},t.prototype.showNoteArea=function(t,e,n){e?(t.style("display","block").attr("transform","translate("+n.tx+","+n.ty+")"),t.selectAll(".note-area-rect").attr("width",n.width).attr("height",n.height),t.selectAll(".note-area-text").attr("x",n.width/2).attr("y",n.height/2)):t.style("display","none")},t.prototype.initContent=function(t){var e=t.append("g").attr("class","shelf-level-g").attr("cursor","pointer").attr("transform",function(t,e){return"translate("+t.tx+","+t.ty+")"});e.append("rect").attr("class","shelf-level-rect").attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("fill",function(t,e){return t.color}).attr("stroke","#ffffff").attr("stroke-width",1),e.append("text").attr("class","shelf-level-text").attr("x",function(t){return t.width/2}).attr("y",function(t){return t.height/2}).text(function(t){return t.id}).attr("fill","#333").style("font-size",12).style("font-weight","600").attr("dominant-baseline","middle").attr("text-anchor","middle"),e.call(this.dragEvent())},t.prototype.updateShelfLevel=function(t,e,n){void 0===n&&(n=!1);var i=h.y(e).selectAll(".shelf-level-g").data(t);i.exit().remove(),i.attr("transform",function(t,e){return"translate("+t.tx+","+t.ty+")"}),this.initContent(i.enter())},t.prototype.breakoutToFree=function(t,e,n){var i=h.y(e).datum();if(i&&!n.isFree){n.tx=i.tx,n.ty=n.ty+i.ty,t.attr("class","free-shlef-level").attr("transform","translate("+n.tx+","+n.ty+")"),this.showNoteArea(this.originArea,!0,n);var r=i.shelfLevels.findIndex(function(e){return e.id===t.datum().id});-1!==r&&(i.shelfLevels.splice(r,1),this.updateShelfLevel(i.shelfLevels,e)),this.svg.node().appendChild(t.node()),n.isFree=!0}},t.prototype.nextFrame=function(t,e,n,i){var r=this;window.requestAnimationFrame(function(){r.updateShelfLevel(e,i),r.internalCollision(t,e,n,i)})},t.prototype.internalCollision=function(t,e,n,i){var r=this;e.forEach(function(o){if(o.id!==t.id){var a=r.checkCollision(t,o);a.isCollision&&(o.ty=o.ty+a.py*r.U,r.nextFrame(o,e,n,i))}o.ty+o.height>n.height&&(o.ty=n.height-o.height,r.nextFrame(o,e,n,i)),o.ty<0&&(o.ty=0,r.nextFrame(o,e,n,i))})},t.prototype.backToNewParent=function(t,e,n){var i=h.y(e).datum();if(i&&n.isFree){t.attr("class","shelf-level-g"),n.tx=0,n.ty=Math.round((n.ty-i.ty)/this.U)*this.U,n.isFree=!1;var r=t.datum();i.shelfLevels.push(r),this.internalCollision(r,i.shelfLevels,i,e),this.updateShelfLevel(i.shelfLevels,e)}t.remove()},t.prototype.backToOriginParent=function(t,e,n){var i=h.y(e).datum();if(i&&n.isFree){t.attr("class","shelf-level-g"),n.tx=n.source.tx,n.ty=n.source.ty,n.isFree=!1;var r=t.datum();i.shelfLevels.push(r),this.updateShelfLevel(i.shelfLevels,e),this.showNoteArea(this.forbidArea,!1)}t.remove()},t.prototype.updateSource=function(t,e){t.source={isFree:!1,tx:t.tx,ty:t.ty}},t.prototype.dragEvent=function(){var t=this;return h.f().on("start",function(e,n){var i=h.y(this);t.parentNode=this.parentNode,t.updateSource(e,!1),t.breakoutToFree(i,this.parentNode,e)}).on("drag",function(e){var n=h.h,i=h.y(this);h.y(this).attr("transform","translate("+(e.tx+n.dx)+","+(e.ty+n.dy)+")"),e.tx+=n.dx,e.ty+=n.dy,t.checkCollisionWidthShelfs(i,e,t.shelfNodes,!1)}).on("end",function(e){var n=h.y(this);t.checkCollisionWidthShelfs(n,e,t.shelfNodes,!0),t.showNoteArea(t.originArea,!1)})},t.prototype.checkCollisionWidthShelfs=function(t,e,n,i){var r,o,a=this,s=!1;if(n.each(function(t,n){a.checkCollision(e,t).isDeepCross&&(s=!0,r=t,o=this)}),s){var h=r.shelfLevels.reduce(function(t,e){return e.height+t},0);h+e.height<=r.height&&i?this.backToNewParent(t,o,e):h+e.height>r.height&&i?this.backToOriginParent(t,this.parentNode,e):h+e.height>r.height&&!i?this.showNoteArea(this.forbidArea,!0,r):h+e.height<=r.height&&!i&&this.showNoteArea(this.forbidArea,!1)}else i&&!s&&a.backToOriginParent(t,a.parentNode,e)},t.prototype.getCenter=function(t){return{x:t.tx+t.width/2,y:t.ty+t.height/2}},t.prototype.checkCollision=function(t,e){var n=this.getCenter(t),i=this.getCenter(e),r=Math.abs(i.x-n.x),o=Math.abs(i.y-n.y);return{isCollision:r<(t.width+e.width)/2&&o<(t.height+e.height)/2,isDeepCross:r>=0&&(r<=t.width/2||r<=e.width/2)&&o>=0&&(o<=t.height/2||o<=e.height/2),px:0===r?1:(i.x-n.x)/r,py:0===o?1:(i.y-n.y)/o}},t}(),f=i.pb({encapsulation:0,styles:[[".shelf-wrap[_ngcontent-%COMP%]{height:100%;width:100%}"]],data:{}});function u(t){return i.Jb(0,[i.Gb(402653184,1,{bookshelf:0}),(t()(),i.rb(1,0,[[1,0],["bookshelf",1]],null,0,"div",[["class","shelf-wrap"]],null,null,null,null,null))],null,null)}var c=i.pb({encapsulation:0,styles:[[""]],data:{}});function d(t){return i.Jb(0,[(t()(),i.rb(0,0,null,null,1,"app-bookshelf",[],null,null,null,u,f)),i.qb(1,114688,null,0,l,[],{data:[0,"data"]},null)],function(t,e){t(e,1,0,e.component.shelfData)},null)}function p(t){return i.Jb(0,[(t()(),i.rb(0,0,null,null,1,"app-bookshelf-demo",[],null,null,null,d,c)),i.qb(1,114688,null,0,o,[r],null,null)],function(t,e){t(e,1,0)},null)}var y=i.nb("app-bookshelf-demo",o,p,{},{},[]),g=n("Ip0R"),v=n("t/Na"),b=function(){return function(){}}(),x=n("ZYCi");n.d(e,"BookshelfDemoModuleNgFactory",function(){return w});var w=i.ob(a,[],function(t){return i.Ab([i.Bb(512,i.j,i.Z,[[8,[s.a,y]],[3,i.j],i.x]),i.Bb(4608,g.l,g.k,[i.u,[2,g.w]]),i.Bb(4608,r,r,[v.c]),i.Bb(1073742336,g.b,g.b,[]),i.Bb(1073742336,b,b,[]),i.Bb(1073742336,x.m,x.m,[[2,x.r],[2,x.k]]),i.Bb(1073742336,a,a,[]),i.Bb(1024,x.i,function(){return[[{path:"",component:o}]]},[])])})}}]);